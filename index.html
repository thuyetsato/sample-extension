<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body style="background-color: #101c2a;">
  <button id="callEx">Call Ex</button>
  <button id="getAccount">Get account</button>
  <button id="connectButton">Connect</button>
  <form action="">
    <textarea name="" id="" cols="30" rows="10"></textarea>
  </form>
  <script>
    // function handleDocumentReady() {
    //   console.log('document ready! ', kadena)
    // }

    // let btnGetAccount = document.getElementById("getAccount")
    // btnGetAccount.addEventListener("click", () => {
    //   btnGetAccount.innerText = 'getting...'
    //   kadena.request({ method: 'kda_getAccount' }).then(response => {
    //     console.log('response ', response)
    //     textarea.value = `Name: ${response.data.name}\nBalance: ${response.data.balance}`
    //     btnGetAccount.innerText = 'Get account'
    //   })
    // }, false);
    
    // document.getElementById("callEx").addEventListener("click", () => {
    //   window.postMessage({
    //     target: 'kda.content',
    //     action: 'open'
    //   }, "*");
    // });
    // const textarea = document.querySelector('textarea');

    // let packageLoad = null
    // if (packageLoad) {
    //   clearInterval(packageLoad)
    // } else {
    //   packageLoad = setInterval(() => {
    //     if (kadena) {
    //       kadena.on('connect', (response) => {
    //         console.log('Kadena extension connected: ', response);
    //       });

    //       kadena.on('transfer', (response) => {
    //         console.log('Local: ', response)
    //         alert(`you receive from ${response.data.address} with amount ${response.data.amount}`)
    //       })
    //       clearInterval(packageLoad)
    //     }
    //   }, 200);
    // }


    const initialize = () => {
      const onboardButton = document.getElementById('connectButton');
      const btnGetAccount = document.getElementById("getAccount");

      const onClickConnect = async () => {
        try {
          // Will open the MetaMask UI
          // You should disable this button while the request is pending!
          let account = await kadena.request({ method: 'kda_requestAccounts' });
          console.log('account ', account)
        } catch (error) {
          console.error(error);
        }
      };

      const isKadenaInstalled = () => {
        const { kadena } = window;

        return Boolean(kadena && kadena.isKadena);
      };

      const KadenaClientCheck = () => {
        if (!isKadenaInstalled()) {
          onboardButton.innerText = 'Click here to install Kadena!';
        } else {
          onboardButton.innerText = 'Connect';
          onboardButton.onclick = onClickConnect;
        }
      };

      KadenaClientCheck();
    };

    window.addEventListener('load', initialize);
  </script>
</body>
</html>
